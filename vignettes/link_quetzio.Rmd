---
title: "Link multiple questionnaires together"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Link multiple questionnaires together}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, include = F}
library(shiny.survey)
```

When you have created multiple questionnaires with help of the *shiny.survey*
already, you may wish to present them to the user sequentially - after the
completion of one it may be handy to handle another.

It can be done through the usage of *conditionalPanel* or by using the *toggle_UI*
method of *quetzio_server*. It can unfortunately cause a lot of unpredicted
effects in the end, with a need for more complex logic for you to implement.

That's why the *shiny.survey* provides an easy way to link multiple questionnaires
together with the use of *quetzio_link_server* R6 class!

>In this vignette there is an assumption that you already know how to construct
questionnaires with *quetzio_survey*. If this assumption is wrong, you should
first look into *Create a questionnaire* vignette.

## How to set up linked questionnaires

If you already know how to create a questionnaire, this will be a breeze. The 
whole procedure is analogous to one used in *quetzio_survey*.

### **server** call

You call *quetzio_link_survey* inside your *server* function.

It takes following arguments:

- **link_id** - module id of you *quetzio_link_server* shiny module.
- **...** - some *quetzio_server* initializing calls, containing configuration
for the modules that you want to link together.
- **output_gsheet** - logical value indicating, if you want to save the results
automatically to some googlesheet. If set to *TRUE*, you will need to also
provide:
  - **output_gsheet_id** - id of the googlesheet to upload answers to
  - **output_gsheet_sheetname** - name of the spreadsheet to upload answers to

To generate linked questionnaires, we can use question sources provided with
the package (see documentation for *quetzio_examples* to get more information)

```{r quetzio_link_wo_desc, eval = F}
# assign to an object to access the state of link from you application
quetzio_link <- quetzio_link_server$new(
  link_id = "linked_quetzios",
  # every questionnaire provided need to be named!
  first_quetzio = quetzio_server$new(
    source_method = "raw",
    source_object = quetzio_examples$questions_lists$link_quetzio_1,
    # and you need to provide unique module ids
    module_id = "quetzio1"
  ),
  second_quetzio = quetzio_server$new(
    source_method = "raw",
    source_object = quetzio_examples$questions_lists$link_quetzio_2,
    module_id = "quetzio2"
  ),
  third_quetzio = quetzio_server$new(
    source_method = "raw",
    source_object = quetzio_examples$questions_lists$link_quetzio_3,
    module_id = "quetzio3"
  )
)
```

> * All module_ids and link_ids needs to be unique - just like during creation
> of regular shiny modules.
> * Remember to provide *quetzio_server\$new()* call directly to the *quetzio_link_server\$new()*.
> You cannot assign them somewhere else and provide them afterwards.

### **ui** call

To bind the interface into UI of your shinyApp, simply state following function.
It takes only one argument: *link_id*.

```{r quetzio_link_wo_desc_ui, eval = F}
# provide the same link_id as in server function
quetzio_link_UI(
  link_id = "linked_quetzios"
)
```

## Provide description!

As with using only single *quetzio_server*, you can generate title, instructions
and descriptions for individual questions. With single questionnaire you could
also build the rest of the interface by providing it directly in the code of UI
of your application.

It is much less straightforward to do with linked questionnaires - the linked
UI will be changing, and you would also need to implement logic using *shinyjs*,
*conditionalPanel* or in any other way.

Providing source for descriptions remedies it!

```{r quetzio_link_w_desc, eval = F}
# we can use the link from previous example
quetzio_link <- quetzio_link_server$new(
  link_id = "linked_quetzios",
  first_quetzio = quetzio_server$new(
    source_method = "raw",
    source_object = quetzio_examples$questions_lists$link_quetzio_1,
    # just provide the description source by stating either
    # 'desc_object', 'desc_yaml' or 'desc_gsheet_id' and 'desc_gsheet_sheetname'
    desc_object = quetzio_examples$description_lists$link_quetzio_1,
    module_id = "quetzio1"
  ),
  second_quetzio = quetzio_server$new(
    source_method = "raw",
    source_object = quetzio_examples$questions_lists$link_quetzio_2,
    desc_object = quetzio_examples$description_lists$link_quetzio_2,
    module_id = "quetzio2"
  ),
  third_quetzio = quetzio_server$new(
    source_method = "raw",
    source_object = quetzio_examples$questions_lists$link_quetzio_3,
    desc_object = quetzio_examples$questions_lists$link_quetzio_3,
    module_id = "quetzio3"
  )
)
```

## Get objects from inside of *quetzio_link_server* object

There are some objects you can get from object to which the linked questionnaires
server was assigned. Taking above assignement as example:

- *quetzio_link$completion()* - the completion rate in form of numeric value between
0 and 1. It is generated as division: 
  - number of completed questionnaires / number of linked questionnaires
- *quetzio_link$messages()* list of *messages()* of individual questionnaires
- *quetzio_link$answers()* list of *answers()* of individual questionnaires
- *quetzio_link$quetzio_list* gives you a way to access any element of object
from any individual *quetzio_survey* object.

